<!DOCTYPE html>
<html lang="zh"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="aoibird">
    <meta name="description" content="aoibird's blog">

    <link rel="stylesheet" href="/assets/main.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
          integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X"
          crossorigin="anonymous">
    <!-- The loading of KaTeX is deferred to speed up page rendering -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
            integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4"
            crossorigin="anonymous"></script>
    <!-- To automatically render math in text elements, include the auto-render extension: -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
            integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa"
            crossorigin="anonymous"
            onload="renderMathInElement(document.body);"></script><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Command line tools for service management in Linux | aoibird</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Command line tools for service management in Linux" />
<meta name="author" content="aoibird" />
<meta property="og:locale" content="zh" />
<meta name="description" content="When it comes to service management in Linux, the controversial role of systemd is undeniable. Despite the numerous critical arguments it has faced, systemd continues to be an essential component of Linux distributions." />
<meta property="og:description" content="When it comes to service management in Linux, the controversial role of systemd is undeniable. Despite the numerous critical arguments it has faced, systemd continues to be an essential component of Linux distributions." />
<link rel="canonical" href="https://aoibird.github.io/blog/2023/09/21/command-line-tools-for-service-management-in-linux.html" />
<meta property="og:url" content="https://aoibird.github.io/blog/2023/09/21/command-line-tools-for-service-management-in-linux.html" />
<meta property="og:site_name" content="aoibird" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-09-21T00:00:00+00:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"aoibird"},"description":"When it comes to service management in Linux, the controversial role of systemd is undeniable. Despite the numerous critical arguments it has faced, systemd continues to be an essential component of Linux distributions.","url":"https://aoibird.github.io/blog/2023/09/21/command-line-tools-for-service-management-in-linux.html","@type":"BlogPosting","headline":"Command line tools for service management in Linux","dateModified":"2023-09-21T00:00:00+00:00","datePublished":"2023-09-21T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://aoibird.github.io/blog/2023/09/21/command-line-tools-for-service-management-in-linux.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="https://aoibird.github.io/feed.xml" title="aoibird" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">aoibird</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/blog/">Blog</a><a class="page-link" href="/bookmarks/">Bookmarks</a><a class="page-link" href="/demo/">Demo</a><a class="page-link rss-subscribe" href="/feed.xml">Feed</a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Command line tools for service management in Linux</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2023-09-21T00:00:00+00:00" itemprop="datePublished">
        <i class="far fa-calendar-alt"></i>2023-09-21 Thu
      </time><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">aoibird</span></span><span class="post-categories"><i class="far fa-folder"></i><a>ToolBox</a></span><span class="post-tags">
        <i class="fas fa-tags"></i><a>Linux</a><a>CLI</a><a>Service</a></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>When it comes to service management in Linux, the controversial role of systemd is undeniable. Despite the numerous critical arguments it has faced, systemd continues to be an essential component of Linux distributions.</p>

<h2 id="systemd">systemd</h2>

<p>To manage a service under systemd, you can use the <code class="language-plaintext highlighter-rouge">systemctl</code> command, followed by a subcommand, and specify the name of the service. These service files are typically located in <code class="language-plaintext highlighter-rouge">/usr/lib/systemd</code> and <code class="language-plaintext highlighter-rouge">~/.config/systemd</code> and end with <code class="language-plaintext highlighter-rouge">.service</code> extention. To enable, disable, start, stop a service, you can use the following commands:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable</span> <span class="nt">--now</span> bluetooth.service <span class="c"># or bluetooth</span>
systemctl start bluetooth.service
systemctl stop bluetooth.service
systemctl disable bluetooth.service
</code></pre></div></div>

<p>This is an example configuration; you can display its content by typing <code class="language-plaintext highlighter-rouge">systemctl cat --user gpg-agent</code>.</p>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># /usr/lib/systemd/user/gpg-agent.service
</span>[<span class="n">Unit</span>]
<span class="n">Description</span>=<span class="n">GnuPG</span> <span class="n">cryptographic</span> <span class="n">agent</span> <span class="n">and</span> <span class="n">passphrase</span> <span class="n">cache</span>
<span class="n">Documentation</span>=<span class="n">man</span>:<span class="n">gpg</span>-<span class="n">agent</span>(<span class="m">1</span>)
<span class="n">Requires</span>=<span class="n">gpg</span>-<span class="n">agent</span>.<span class="n">socket</span>

[<span class="n">Service</span>]
<span class="n">ExecStart</span>=/<span class="n">usr</span>/<span class="n">bin</span>/<span class="n">gpg</span>-<span class="n">agent</span> --<span class="n">supervised</span>
<span class="n">ExecReload</span>=/<span class="n">usr</span>/<span class="n">bin</span>/<span class="n">gpgconf</span> --<span class="n">reload</span> <span class="n">gpg</span>-<span class="n">agent</span>
</code></pre></div></div>
<p>You can observe that the configuration is declarative; it involves specifying dependencies and issuing start or reload commands.</p>

<h2 id="system-v">System V</h2>

<p>Before systemd, the traditional method for managing services was called System V. On older systems, you can use the following commands to start, stop, and restart a service:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>service httpd start
service httpd restart
service httpd stop
</code></pre></div></div>
<p>The configuration file for these services are located in <code class="language-plaintext highlighter-rouge">/etc/init</code>, and they consist of scripts that define the steps required to start or stop a service. This is imperative, in contrast to systemd, which adopts a declarative approach to service configuration.</p>

<p>This is an example configuration located in <code class="language-plaintext highlighter-rouge">/etc/init/docker.conf</code>:</p>
<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">description</span> <span class="s2">"Docker daemon"</span>

<span class="n">start</span> <span class="n">on</span> (<span class="n">filesystem</span> <span class="n">and</span> <span class="n">net</span>-<span class="n">device</span>-<span class="n">up</span> <span class="n">IFACE</span>!=<span class="n">lo</span>)
<span class="n">stop</span> <span class="n">on</span> <span class="n">runlevel</span> [!<span class="m">2345</span>]

<span class="n">limit</span> <span class="n">nofile</span> <span class="m">524288</span> <span class="m">1048576</span>

<span class="c"># Having non-zero limits causes performance problems due to accounting overhead
# in the kernel. We recommend using cgroups to do container-local accounting.
</span><span class="n">limit</span> <span class="n">nproc</span> <span class="n">unlimited</span> <span class="n">unlimited</span>

<span class="n">respawn</span>

<span class="n">kill</span> <span class="n">timeout</span> <span class="m">20</span>

<span class="n">pre</span>-<span class="n">start</span> <span class="n">script</span>
	<span class="c"># see also https://github.com/tianon/cgroupfs-mount/blob/master/cgroupfs-mount
</span>	<span class="n">if</span> <span class="n">grep</span> -<span class="n">v</span> <span class="s1">'^#'</span> /<span class="n">etc</span>/<span class="n">fstab</span> | <span class="n">grep</span> -<span class="n">q</span> <span class="n">cgroup</span> \
		|| [ ! -<span class="n">e</span> /<span class="n">proc</span>/<span class="n">cgroups</span> ] \
		|| [ ! -<span class="n">d</span> /<span class="n">sys</span>/<span class="n">fs</span>/<span class="n">cgroup</span> ]; <span class="n">then</span>
		<span class="n">exit</span> <span class="m">0</span>
	<span class="n">fi</span>
	<span class="c"># &lt;......&gt;
</span><span class="n">end</span> <span class="n">script</span>

<span class="n">script</span>
	<span class="c"># modify these in /etc/default/$UPSTART_JOB (/etc/default/docker)
</span>	<span class="n">DOCKERD</span>=/<span class="n">usr</span>/<span class="n">bin</span>/<span class="n">dockerd</span>
	<span class="n">DOCKER_OPTS</span>=
	<span class="n">if</span> [ -<span class="n">f</span> /<span class="n">etc</span>/<span class="n">default</span>/$<span class="n">UPSTART_JOB</span> ]; <span class="n">then</span>
		. /<span class="n">etc</span>/<span class="n">default</span>/$<span class="n">UPSTART_JOB</span>
	<span class="n">fi</span>
	<span class="n">exec</span> <span class="s2">"$DOCKERD"</span> $<span class="n">DOCKER_OPTS</span> --<span class="n">raw</span>-<span class="n">logs</span>
<span class="n">end</span> <span class="n">script</span>

<span class="c"># Don't emit "started" event until docker.sock is ready.
# See https://github.com/docker/docker/issues/6647
</span><span class="n">post</span>-<span class="n">start</span> <span class="n">script</span>
	<span class="n">DOCKER_OPTS</span>=
	<span class="n">DOCKER_SOCKET</span>=
	<span class="n">if</span> [ -<span class="n">f</span> /<span class="n">etc</span>/<span class="n">default</span>/$<span class="n">UPSTART_JOB</span> ]; <span class="n">then</span>
		. /<span class="n">etc</span>/<span class="n">default</span>/$<span class="n">UPSTART_JOB</span>
	<span class="n">fi</span>
	<span class="c"># &lt;......&gt;
</span><span class="n">end</span> <span class="n">script</span>
</code></pre></div></div>

<h2 id="further-reading">Further reading</h2>

<ul>
  <li><a href="https://wiki.archlinux.org/title/systemd">systemd - Arch Wiki</a></li>
</ul>


  </div><script src="https://giscus.app/client.js"
        data-repo="aoibird/aoibird.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyMDE3NzM2OTA="
        data-category="General"
        data-category-id="DIC_kwDODAbSes4Cbh49"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
<noscript>Please enable JavaScript to view the comments.</noscript>
<a class="u-url" href="/blog/2023/09/21/command-line-tools-for-service-management-in-linux.html" hidden></a>
</article>

      </div>
    </main>

  </body>

</html>
